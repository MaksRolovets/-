```python
from fastapi import HTTPException, status

from functools import wraps

#Функции должны быть async

class PremissionChecker:

    def __init__ (self, roles:list[str]):

        self.roles = roles

    def __call__(self, func):

        @wraps(func)

        async def wrapper(*args, **kwargs):

            user = kwargs.get("current_user")

            if not user:

                raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Требуется аунтефикация")

            if "admin" in user.roles:

                return await func(*args, **kwargs)

            if not any(role in user.roles for role in self.roles):

                raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Недостаточно прав для доступа")

            return await func(*args, **kwargs)

        return wrapper

```

Класс ролей** and Класс владение

```python

from fastapi import HTTPException, status, Depends

from functools import wraps

from depencies import get_current_user

from model import User

from db import resources

  

class PremissionChecker:

    def __init__ (self, roles:list[str]):

        self.roles = roles

    def __call__(self, current_user : User = Depends(get_current_user)):

        if not current_user:

            raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Требуется аунтефикация")

        if "admin" in current_user.roles:

            return

        if not any(role in current_user.roles for role in self.roles):

            raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Недостаточно прав для доступа(Для гостя требуется аунтефикации)")

        return

class OwnershipCheker:

    def __call__(self,username : str, current_user : User = Depends(get_current_user)):

        if not current_user:

            raise HTTPException(status_code=status.HTTP_403_FORBIDDEN, detail="Требуется аунтефикация")

        if "admin" in current_user.roles:

            return

        if not resources[username]["is_public"]:

            if username != current_user.username:

                raise HTTPException(

                status_code=403,

                detail="Нет доступа к чужому ресурсу"

                )

        if resources[username]["is_public"]:

            return

        raise HTTPException(status_code=404, detail="Not found")

```