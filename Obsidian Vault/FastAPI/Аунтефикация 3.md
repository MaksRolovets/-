```python
from fastapi import FastAPI, Cookie, Response, HTTPException

from model import User

from datetime import datetime

import uuid, itsdangerous

  

app = FastAPI()

  

data = {

    "username":"123",

    "password":"123"

}

  

SECRET_KEY = "123"

sigin = itsdangerous.URLSafeTimedSerializer(SECRET_KEY)

  

def create_cookie(user_id : str, response : Response, need: bool = False):

    time = str(int(datetime.now().timestamp()))

    signature = sigin.dumps(time+'.'+user_id)

    token= f"{user_id}.{signature}"

    response.set_cookie(key="session_token", value=token, httponly=True, max_age=60)

    if need:

        return token

    else:

        return {"token":token}

  

def veryfi_cookie(token : str, res : Response):

    user_id, unsigned = token.split('.', 1)

    try:

        times , unsigned = sigin.loads(unsigned).split('.', 1)

        dif_time= int(datetime.now().timestamp()) - int(times)

        if user_id == unsigned:

            if dif_time >= 30:

                create_cookie(user_id,res, False)

                print("Продлен, прошло", dif_time)

            else:

                print("непродлен" ,dif_time)

        else:

            raise HTTPException(status_code=401, detail="Невалидный куки")

    except itsdangerous.BadSignature:

        raise HTTPException(status_code=401, detail="Токен подделан")

    except itsdangerous.SignatureExpired:

        raise HTTPException(status_code=401, detail="Время жизни куки истекло")

    return True

  

@app.post("/login")

def login(user_data : User, res : Response):

    if user_data.username == data["username"] and user_data.password == data["password"]:

        user_id = str(uuid.uuid4())

        token = create_cookie(user_id,res, need =True)

        return {"token":token}

    else:

        raise HTTPException(status_code=401, detail="Неверный логин или пароль")

@app.get("/profile")

def profile(res : Response,session_token = Cookie(default=None)):

    if not session_token:

        raise HTTPException(status_code=401, detail="Нет куки")

    if veryfi_cookie(session_token, res):

        return(data)
```